<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" 
		 xmlns:mx="library://ns.adobe.com/flex/mx" 
		 width="100%" height="100%" xmlns:local="*"
		 creationComplete="on_creation_complete(event)" xmlns:controls="controls.*"
>
<fx:Script>
<![CDATA[
	import flash.filesystem.File;
	
	import mx.collections.ArrayCollection;
	import mx.core.IFlexDisplayObject;
	import mx.events.FlexEvent;
	import mx.managers.PopUpManager;
	
	import spark.components.Button;
	import spark.components.Group;
	import spark.components.Panel;
	import spark.components.TitleWindow;

protected function on_creation_complete(event:FlexEvent):void
{
	new Engine();
	Engine.engine.data_provider = dp;
	Engine.engine.open_database_connection("");
}

[Bindable] private var dp:ArrayCollection = new ArrayCollection();

	
protected function barbutton1_clickHandler(event:MouseEvent):void
{
	var wnd:IFlexDisplayObject = PopUpManager.createPopUp(this, AppTitleWindow , false);
	var w:AppTitleWindow = wnd as AppTitleWindow;
	
	w.title = "Отделения";
	w.holder.addChild(new DepartmentsEditorWindow());
	w.ctrl.addChild(new Button());
	
	w.area.setStyle("paddingLeft", 8);
	w.area.setStyle("paddingRight", 8);	
	w.area.setStyle("paddingTop", 8);
	w.area.setStyle("paddingBottom", 8);
	
	PopUpManager.centerPopUp(w);	
}
	
protected function barbutton2_clickHandler(event:MouseEvent):void
{

	var wnd:IFlexDisplayObject = PopUpManager.createPopUp(this, AppTitleWindow , false);
	var w:AppTitleWindow = wnd as AppTitleWindow;
	
	w.title = "О программе";

	w.area.setStyle("paddingLeft", 8);
	w.area.setStyle("paddingRight", 8);	
	w.area.setStyle("paddingTop", 8);
	w.area.setStyle("paddingBottom", 8);

	w.ctrl.setStyle("horizontalAlign", "right");
	
	var btn:Button = new Button();
	btn.label = "Закрыть";
	btn.addEventListener(MouseEvent.CLICK, w.close_event, false, 0, true);
		
	w.ctrl.addChild(btn);	
	
	PopUpManager.centerPopUp(wnd);
}
	
protected function btn_open_db_clickHandler(event:MouseEvent):void
{
//	var file:File = File.
	var fr:File = new File();
	fr.addEventListener(Event.SELECT, on_file_selected);
	
	var filter1:FileFilter = new FileFilter("DB Файлы (*.db, *.sqlite)", "*.db;*.sqlite"); 
	var filter2:FileFilter = new FileFilter("Все Файлы", "*.*");
	
	fr.browseForOpen("", [filter1, filter2]);
}

protected function on_file_selected(e:Event):void
{
	var fr:File = e.target as File;
	
	fr.removeEventListener(Event.SELECT, on_file_selected);	

	var file_name:String = fr.nativePath;
	var disp_name:String = fr.name;
	
	Engine.engine.open_database_connection(file_name, disp_name);	
}	
	
	
]]>
</fx:Script>
<mx:VBox width="100%" height="100%" paddingLeft="8" paddingRight="8" paddingTop="8" paddingBottom="8">
	
	<s:HGroup width="100%">
		<controls:BarButton id="btn_open_db" label="Открыть DB Файл" icon="{Icons.ico_database}" click="btn_open_db_clickHandler(event)" />
		<s:Spacer width="40" />

		<controls:BarButton label="Отделения" click="barbutton1_clickHandler(event)" />		
		<controls:BarButton label="Добавить" icon="{Icons.ico_add}" />
		<controls:BarButton label="Уволить"  icon="{Icons.ico_delete}" />
		<s:Spacer width="100%" />
		<controls:BarButton label="О программе" icon="{Icons.ico_about}" click="barbutton2_clickHandler(event)"/>		
	</s:HGroup>	
	
	<mx:HBox width="100%" height="100%">
		

	
	<mx:DataGrid width="100%" height="100%" dataProvider="{dp}">
		<mx:columns>
			<fx:Array>
				<mx:DataGridColumn headerText="ID" width="10" dataField="EmplID"/>
				<mx:DataGridColumn headerText="Имя" width="30" dataField="FirstName"/>
				<mx:DataGridColumn headerText="Фамилия" width="30" dataField="LastName"/>	
				<mx:DataGridColumn headerText="Отделение" width="30" dataField="DeptID" itemRenderer="renderers.DeptItemRenderer"/>
				<mx:DataGridColumn headerText="Должность" width="30" dataField="Position"/>			
			
			</fx:Array>
		</mx:columns>			
	</mx:DataGrid>

	<local:DepartmentsEditorWindow width="100%" height="100%" />
		
	</mx:HBox>

</mx:VBox>
	
<local:StatusBar />
	
<fx:Declarations>
</fx:Declarations>
</mx:VBox>
